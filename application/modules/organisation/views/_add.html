<div class="box box-{skin_box} skin_box">
    <div class="box-body">
        {breadcrumb}
        <legend class="">
            {m_add}
            <span style="text-transform: capitalize;">
                {controller} :
            </span>
        </legend>
        <form action="" class="form-horizontal row" enctype="multipart/form-data" id="form_{controller}" method="POST" role="form">
            <div class="col-sm-6">
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Name :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_name}" id="{controller}_name" name="{controller}_name" placeholder="Name" required="required" type=""/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Domain :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_domain}" id="{controller}_domain" name="{controller}_domain" placeholder="eg.: www.example.com" type=""/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Sub Domain :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_subdomain}" id="{controller}_subdomain" name="{controller}_subdomain" pattern="^[a-z0-9]+$" placeholder="eg.: school_01" required="required" type="text"/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Type :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <select class="form-control" id="{controller}_type" name="{controller}_type">
                            <option>
                                School
                            </option>
                            <option>
                                Company
                            </option>
                            <option>
                                Community
                            </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Email :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_email}" id="{controller}_email" name="{controller}_email" placeholder="Email" type=""/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Address :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_address}" id="{controller}_address" name="{controller}_address" placeholder="eg.: RT.01 / RW.02" style="margin-bottom:10px" type=""/>
                        <select class="form-control" id="kodepos_id" name="kodepos_id">
                        </select>
                        <input class="form-control" id="kelurahan_kecamatan" readonly="readonly" style="margin-top:10px" type=""/>
                        <input class="form-control" id="kabupaten_kodepos" readonly="readonly" style="margin-top:10px" type=""/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Phone :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_phone}" id="{controller}_phone" name="{controller}_phone" placeholder="eg.: 021-1234556" type=""/>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <label class="control-label">
                            Fax :
                        </label>
                    </div>
                    <div class="col-sm-9">
                        <input class="form-control" data-value="{{controller}_fax}" id="{controller}_fax" name="{controller}_fax" placeholder="eg.: 021-1234556" type=""/>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <div class="col-sm-12">
                        <label class="control-label">
                            Logo :
                        </label>
                        <div>
                            <img id="{controller}_logo" src="{base}/files/images/default-logo.png" width="100px"/>
                        </div>
                        <input accept="image/png" class="form-control" data-value="{{controller}_logo}" id="{controller}_logo_file" name="{controller}_logo" placeholder="" type="file"/>
                        <small>
                            <i>
                                Allowed Type: *.png, Dimension : 256 x 256 pixel
                            </i>
                        </small>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <button class="btn btn-success" type="submit">
                            Submit
                        </button>
                        <a class="btn btn-danger" href="{base}/customer/profile">
                            Cancel
                        </a>
                    </div>
                </div>
            </div>
            <div class="modal modal- fade" id="modal_subdomain">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button aria-hidden="true" class="close" data-dismiss="modal" type="button">
                                Ã—
                            </button>
                            <h4 class="modal-title">
                                Modal title
                            </h4>
                        </div>
                        <div class="modal-body text-center">
                            <i class="fa fa-fw fa-exclamation-triangle fa-5x text-yellow">
                            </i>
                            <h4 class="message">
                            </h4>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- -->
<!-- -->
<script src="{base}/files/bower_components/formvalidation.io/dist/js/formValidation.min.js">
</script>
<script src="{base}/files/bower_components/formvalidation.io/dist/js/framework/bootstrap.min.js">
</script>
<script type="text/javascript">
    $('#kodepos_id').select2({ 
        placeholder: 'Kelurahan / Desa',
        allowClear: true,
        width: "100%", 
        minimumInputLength: 4,
        ajax: {
            url: '{base}/country/kelurahan_ajax',
            dataType: 'json',
            delay: 250,
            type: "GET",
            data: function (params) {
                console.log(params);
                var queryParameters = {
                    search: params.term
                }
                return queryParameters;
            },
            processResults: function (data) {
                // console.log(data);
                return {
                    results: data
                };
            },
            cache: true
        }
    }); 
    ////////////////////
    ////////////////////
    $('#kodepos_id').on('change', function(event) {
        event.preventDefault();
        id = $(this).val();

        if (id != null) {
            // console.log(id);
            $.ajax({
                url: '{base}/country/kelurahan_ajax', 
                data: {id: id},
            })
            .done(function(data) {
                // console.log(data);
                $.each(data, function(index, val) {
                    $('#kelurahan_kecamatan').val('Kel. ' + val.kelurahan + ' - Kec. ' + val.kecamatan);
                    $('#kabupaten_kodepos').val(val.jenis_kabupaten + ' ' + val.kabupaten + ' - '+val.kodepos);
                    $('#{controller}_kelurahan').val(val.kelurahan);
                    $('#{controller}_kecamatan').val(val.kecamatan);
                    $('#{controller}_jenis_kabupaten').val(val.jenis_kabupaten);
                    $('#{controller}_kabupaten').val(val.kabupaten);
                    $('#{controller}_propinsi').val(val.propinsi);
                    $('#{controller}_kodepos').val(val.kodepos);
                });
                $('#{controller}_ktp').focus();
                
            })
            .fail(function(error) {
                console.log(error.responseText);
            });
        }else{
            $('#kelurahan_kecamatan').val('');
            $('#kabupaten_kodepos').val('');
        }
        

    });
    ////////////////////
    ////////////////////
    // kodepos_id_before = $('#kodepos_id_before').val();
    // if (kodepos_id_before != '') {
    //     kodepos_before(kodepos_id_before);
    // }
    // function kodepos_before(id) {
    //     $.ajax({
    //         url: '{base}/country/kelurahan_ajax', 
    //         data: {id: id},
    //     })
    //     .done(function(data) {
    //         // console.log(data);
    //         $.each(data, function(index, val) {
    //             $('#kelurahan_kecamatan').val('Kel. ' + val.kelurahan + ' - Kec. ' + val.kecamatan);
    //             $('#kabupaten_kodepos').val(val.jenis_kabupaten + ' ' + val.kabupaten + ' - '+val.kodepos);
    //             $('#{controller}_kelurahan').val(val.kelurahan);
    //             $('#{controller}_kecamatan').val(val.kecamatan);
    //             $('#{controller}_jenis_kabupaten').val(val.jenis_kabupaten);
    //             $('#{controller}_kabupaten').val(val.kabupaten);
    //             $('#{controller}_propinsi').val(val.propinsi);
    //             $('#{controller}_kodepos').val(val.kodepos);
    //         });
    //         // $('#{controller}_ktp').focus();
            
    //     })
    //     .fail(function(error) {
    //         console.log(error.responseText);
    //     }); 
    // }
    ////////////////////
    ////////////////////
    $('#{controller}_type').select2();
    ////////////////////
    $('#form_{controller}').formValidation();
    ////////////////////
    ////////////////////
    $('#{controller}_subdomain').on('change', function(event) {
        event.preventDefault();
        subdomain = $(this).val();
        if ($(this).val() != '') {
            $.ajax({
                url: '{base}/{controller}/check_subdomain',
                dataType:'json',
                data: {subdomain: subdomain},
            })
            .done(function(res) {
                // console.log(res);
                if (res.status == 1) {
                    $('#modal_subdomain').find('.modal-title').html('Warning');
                    $('#modal_subdomain').find('.message').html(res.message);
                    $('#modal_subdomain').modal('show');
                    $('#modal_subdomain').on('hidden.bs.modal', function(){
                        $('#{controller}_subdomain').val('').focus();
                    });
                }

            })
            .fail(function(err) {
                console.log(err.responsText);
            });
            
        }

    });
    ////////////////////
    ///////////////////
    function readURL(input, img_id_or_class) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                // console.log(e);
                $(img_id_or_class).attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    ///////////////////

    $("#{controller}_logo_file").change(function() {
        var _URL = window.URL || window.webkitURL;
        var image, file;
        var el = this ;
        $('#{controller}_logo_remove').removeClass('hidden').show(); 
        if ((file = el.files[0])) {
            image = new Image();
            image.src = _URL.createObjectURL(file);
            image.onload = function() {
                if (this.width == 256 && this.height == 256 ) {
                    readURL(el, '#{controller}_logo');
                    readURL(el, $('.preview_card_logo').find('img'));
                }else{
                    alert('Error:\n\nThe logo dimension must 256 x 256 pixels.');
                    $("#{controller}_logo_file").val('');
                    $('#{controller}_logo').attr('src', '{base}/files/images/default-logo.png');
                }
            }
        }
    });
    ///////////////////
</script>

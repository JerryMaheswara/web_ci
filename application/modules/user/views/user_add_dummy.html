<link href="{base}/files/bower_components/AdminLTE/plugins/iCheck/square/blue.css" rel="stylesheet"/>
<!-- <link href="{base}/files/css/formValidation.min.css" rel="stylesheet"/> -->
<link href="{base}/files/bower_components/formvalidation.io/dist/css/formValidation.min.css" rel="stylesheet"/>
<section class="row">
    <div class="col-sm-6 col-sm-offset-3 col-xs-12">
        <div class="box box-danger">
            <div class=" box-body">
                <legend>
                    Registration
                </legend>
                <form action="" class="form-horizontal" enctype="multipart/form-data" id="form_register" method="POST">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Email :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_email" name="user_email" placeholder="Email" required="required" type="email" value="xxx@domain.com"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Password :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_password" name="user_password" placeholder="Password" required="required" type="password" value="1234"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Confirm Password :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm password" required="required" type="password" value="1234"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Given Name :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_given_name" name="user_given_name" placeholder="Given Name" required="required" type="text" value="Jerry"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Family Name :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_family_name" name="user_family_name" placeholder="Family Name" required="required" type="text" value="Maheswara"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Nick Name :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_nick_name" name="user_nick_name" placeholder="Nick Name" type="text" value=""/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Security PIN :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_security_pin" maxlength="4" name="user_security_pin" placeholder="Security PIN" required="required" type="number" value="1234"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Date of Birth :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" data-date-end-date="-10y" data-date-format="yyyy-mm-dd" id="user_birthday" name="user_birthday" placeholder="Date of Birth" required="required" type="text" value="1980-10-31"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Ocupation :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_occupation" name="user_occupation" placeholder="Ocupation" type="text" value="Student"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Gender :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="user_gender" name="user_gender" required="required">
                                <option value="1">
                                    Male
                                </option>
                                <option value="2">
                                    Female
                                </option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <legend>
                            Access Level
                        </legend>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Access Level :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="role_label_id" name="role_label_id" required="required">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Branch :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="branch_id" name="branch_id" required="required">
                            </select>
                        </div>
                    </div>
                    <div>
                        <legend>
                            Currency
                        </legend>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Currency :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="currency_id" name="currency_id" required="required">
                            </select>
                        </div>
                    </div>
                    <div>
                        <legend>
                            Contact Details
                        </legend>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Residential Address :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_address" name="user_address" placeholder="Residential Address" required="required" type="text" value="Residential Address"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            City / Town / Suburb  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_city" name="user_city" placeholder="City / Town / Suburb " required="required" type="text" value="City"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            State  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_state" name="user_state" placeholder="State" required="required" type="text" value="State"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Postcode  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_postcode" maxlength="5" name="user_postcode" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" placeholder="Postcode" size="5" type="number" value=""/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Phone  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_phone" name="user_phone" placeholder="Phone" required="required" type="text" value="231231312"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Country  :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="country_id" name="country_id" required="required">
                            </select>
                        </div>
                    </div>
                    <div>
                        <legend>
                            Document / Electronic Data Source
                        </legend>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            ID Type  :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="user_nik_type" name="user_nik_type" required="required">
                                <option value="Passport">
                                    Passport
                                </option>
                                <option value="Photo ID">
                                    Photo ID
                                </option>
                                <option value="Driver's License">
                                    Driver's License
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            ID Number  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_nik_number" name="user_nik_number" placeholder="ID Number" required="required" type="number" value="1234"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            ID Issuer  :
                        </label>
                        <div class="col-sm-8">
                            <select class="form-control" id="user_nik_issuer" name="user_nik_issuer" required="required">
                                <option value="Ministry of Foreign Affairs">
                                    Ministry of Foreign Affairs
                                </option>
                                <option value="RTA">
                                    RTA
                                </option>
                                <option value="Australia">
                                    Australia
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            ID Expired Date  :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" data-date-format="yyyy-mm-dd" id="user_nik_expired" name="user_nik_expired" placeholder="ID Expired Date" required="required" type="text" value="2017-03-24"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            ID Image :
                        </label>
                        <div class="col-sm-8">
                            <input class="form-control" id="user_nik_image" name="user_nik_image" required="required" type="file"/>
                        </div>
                    </div>
                    <div>
                        <hr/>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            Captcha  :
                        </label>
                        <div class="col-sm-8">
                            <span id="image_captcha">
                                {captcha}{image}{/captcha}
                            </span>
                            <button class="btn btn-flat btn-success pull-right" id="reload_captcha" type="button">
                                <i class="fa fa-refresh">
                                </i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4">
                            <input class="form-control" id="captcha" name="captcha" placeholder="Captcha" required="required" type=""/>
                            <span class="hidden fa fa-pencil form-control-feedback">
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4">
                            <div class="checkbox icheck">
                                <label>
                                    <div aria-checked="false" aria-disabled="false" class="icheckbox_square-blue" style="position: relative;">
                                        <input id="check_agree" style="position: absolute; top: -20%; left: -20%; display: block; width: 140%; height: 140%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;" type="checkbox"/>
                                        <ins class="iCheck-helper" style="position: absolute; top: -20%; left: -20%; display: block; width: 140%; height: 140%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;">
                                        </ins>
                                    </div>
                                    I agree to the
                                    <a href="{base}/about/terms">
                                        terms
                                    </a>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-8 col-sm-offset-4">
                            <button class="btn btn-primary btn-flat" id="btn_register" type="button">
                                Register
                            </button>
                        </div>
                    </div>
                </form>
                <div class="social-auth-links text-center hidden">
                    <p>
                        - OR -
                    </p>
                    <a class="btn btn-block btn-social btn-facebook btn-flat-" href="#">
                        <i class="fa fa-facebook">
                        </i>
                        Sign up using Facebook
                    </a>
                    <a class="btn btn-block btn-social btn-google btn-flat-" href="#">
                        <i class="fa fa-google">
                        </i>
                        Sign up using Google+
                    </a>
                </div>
                <a class="text-center" href="{base}/login.html">
                    I already have a membership
                </a>
            </div>
            <!-- /.form-box -->
        </div>
    </div>
</section>
<!-- ========================================================================== -->
<!-- ========================================================================== -->
<!-- ========================================================================== -->
<!-- ========================================================================== -->
<div class="modal modal-danger fade" id="modal_captcha">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" class="close" data-dismiss="modal" type="button">
                    ×
                </button>
                <h4 class="modal-title">
                    Error:
                </h4>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-exclamation-circle fa-4x">
                    </i>
                    <h4>
                        Invalid captcha code or expired. Please retype captcha...!!!
                    </h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal" type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ========================================================================== -->
<!-- ========================================================================== -->
<div class="modal modal-danger fade" id="modal_email">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" class="close" data-dismiss="modal" type="button">
                    ×
                </button>
                <h4 class="modal-title">
                    Error
                </h4>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-exclamation-circle fa-4x">
                    </i>
                    <h4>
                        Email already registered. Choose other email...!!
                    </h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal" type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ========================================================================== -->
<div class="modal modal-warning fade" id="modal_agree">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" class="close" data-dismiss="modal" type="button">
                    ×
                </button>
                <h4 class="modal-title">
                    Warning
                </h4>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-exclamation-triangle fa-4x">
                    </i>
                    <h4>
                        You must agree to the terms, and fill in all column required!
                    </h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal" type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ========================================================================== -->
<div class="modal modal-success fade" id="modal_sukses">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" class="close" data-dismiss="modal" type="button">
                    ×
                </button>
                <h4 class="modal-title">
                    Congratulation
                </h4>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-exclamation-circle fa-4x">
                    </i>
                    <h4>
                        Register successfull...!!
                    </h4>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" data-dismiss="modal" type="button">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ========================================================================== -->
<style type="text/css">
    .has-error .control-label,
    .has-error .help-block,
    .has-error .form-control-feedback {
        color: #dd4b39;
    }

    .has-success .control-label,
    .has-success .help-block,
    .has-success .form-control-feedback {
        color: #00a65a;
    }
    #form_register .form-control-feedback {
        z-index: 100;
    }
    .has-error .select2-selection {
        border-color: #dd4b39;
    }
    .has-success .select2-selection {
        border-color: #00a65a;
    }
</style>
<!-- ========================================================================== -->
<!-- ========================================================================== -->
<!-- <script src="{base}/files/js/formValidation.min.js"></script> -->
<script src="{base}/files/bower_components/formvalidation.io/dist/js/formValidation.min.js">
</script>
<script src="{base}/files/bower_components/formvalidation.io/dist/js/framework/bootstrap.min.js">
</script>
<script src="{base}/files/bower_components/AdminLTE/plugins/iCheck/icheck.min.js">
</script>
<!-- <link href="{base}/files/bower_components/AdminLTE/plugins/select2/select2.min.css" rel="stylesheet" type="text/css"/> -->
<script src="{base}/files/bower_components/AdminLTE/plugins/select2/select2.min.js">
</script>
<link href="{base}/files/bower_components/AdminLTE/plugins/datepicker/datepicker3.css" rel="stylesheet"/>
<script src="{base}/files/bower_components/AdminLTE/plugins/datepicker/bootstrap-datepicker.js">
</script>
<script>
    $(document).ready(function() {
        // -------------------------------------------------------------------- //
        ////////////////////
        ////////////////////
        $('#user_birthday').datepicker({
            autoclose: true,
            // Date: '-7y',
            // startView:1,
            //     // useCurrent: false, 
            //     // dateFormat: 'yy-mm-dd',
            //     // defaultDate: '01/01/1980'
        }).val('1980-10-31').on('change', function(event) {
            event.preventDefault();
            $('#form_register').formValidation('revalidateField', 'user_birthday');
        });
        // .datepicker('setDate', '1980-01-31')
        ////////////////////
        ////////////////////
        $('#user_nik_expired').datepicker({
            autoclose: true,
            dateFormat: 'yy-mm-dd'
        }).on('change', function(event) {
            event.preventDefault();
            $('#form_register').formValidation('revalidateField', 'user_nik_expired');
        });
        ////////////////////
        ////////////////////
        $('#user_nik_issuer').select2({
            placeholder: 'ID Issuer',
            allowClear: true,
            width: "100%",
        }).val('RTA').trigger('change');
        ////////////////////
        ////////////////////
        $('#user_nik_type').select2({
            placeholder: 'ID Type',
            allowClear: true,
            width: "100%",
        }).val('Passport').trigger('change');
        ////////////////////
        ////////////////////
        $('#user_gender').select2({
            placeholder: 'Gender',
            allowClear: true,
            width: "100%",
        }).val('1').trigger('change');
        ////////////////////
        ////////////////////
        var role_label = $.ajax({
            type: "GET",
            url: "{base}/user/role_ajax",
            dataType: "json",
            async: false,
            cache: true
        }).responseJSON;
        // console.log(role_label);
        $('#role_label_id').select2({
            width: "100%",
            multiple: false,
            data: role_label,
            allowClear: true,
            placeholder: 'Access Level',
        }).val('1').trigger('change');
        ////////////////////
        ////////////////////
        var branch = $.ajax({
            type: "GET",
            url: "{base}/branch/branch_ajax",
            dataType: "json",
            async: false,
            cache: true
        }).responseJSON;
        // console.log(branch);
        $('#branch_id').select2({
            width: "100%",
            multiple: false,
            data: branch,
            allowClear: true,
            placeholder: 'Branch',
        }).val('1').trigger('change');
        ////////////////////
        ////////////////////
        var currency = $.ajax({
            type: "GET",
            url: "{base}/currency/currency_ajax",
            dataType: "json",
            async: false,
            cache: true
        }).responseJSON;
        // console.log(currency);
        $('#currency_id').select2({
            width: "100%",
            multiple: false,
            data: currency,
            allowClear: true,
            placeholder: 'Currency',
        }).val('142').trigger('change');
        ////////////////////
        ////////////////////
        var country = $.ajax({
            type: "GET",
            url: "{base}/country/country_ajax",
            dataType: "json",
            async: false,
            cache: true
        }).responseJSON;
        // console.log(country);
        $('#country_id').select2({
            width: "100%",
            multiple: false,
            data: country,
            allowClear: true,
            placeholder: 'Country',
        }).val('14').trigger('change');
        ////////////////////
        ////////////////////
        $('input').iCheck({
            checkboxClass: 'icheckbox_square-blue',
            radioClass: 'iradio_square-blue',
            increaseArea: '20%' // optional
        });
        // -------------------------------------------------------------------- //
        ////////////////////
        ////////////////////
        $('#reload_captcha').click(function(event) {
            /* Act on the event */
            $.ajax({
                url: '{base}/register/reload_captcha',
            }).done(function(data) {
                $('#image_captcha').html(data);
            }).fail(function() {
                console.log("error");
            });
        });
        // -------------------------------------------------------------------- //
        // -------------------------------------------------------------------- //
        // -------------------------------------------------------------------- //
        ////////////////////
        ////////////////////
        $('#form_register').formValidation({
            framework: 'bootstrap',
            icon: {
                valid: 'fa fa-ok',
                invalid: 'fa fa-remove',
                validating: 'fa fa-refresh'
            },
            fields: {
                confirm_password: {
                    validators: {
                        identical: {
                            field: 'user_password',
                            message: 'The password and its confirm are not the same'
                        }
                    }
                },
                user_password: {
                    validators: {
                        identical: {
                            field: 'confirm_password',
                            message: 'Please retype password in column bellow.'
                        }
                    }
                },
            }
        }).on('err.form.fv', function(e) {
            // $('#modal_agree').modal('show');
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            var form_data = new FormData($('#form_register')[0]);
            $.ajax({
                url: '{base}/register',
                type: 'POST',
                data: form_data,
                mimeTypes: 'multipart/form-data',
                cache: false,
                contentType: false,
                processData: false
            }).done(function(data) {
                console.log(data);
                $('#modal_sukses').modal('show');
                $('#form_register').get(0).reset();
                // $("#form_register select").val('').trigger('change');
            }).fail(function(error) {
                console.log(error.responseText);
            });
        });
        // -------------------------------------------------------------------- //
        ////////////////////
        ////////////////////
        $('#btn_register').click(function(event) {
            if ($('#check_agree').is(':checked') && $('#user_email').val() !== '') {
                // -------------------------------------------------------------------- //
                var cek_email = $.ajax({
                    url: '{base}/register/ajax_email',
                    type: 'POST',
                    data: {
                        user_email: $('#user_email').val()
                    },
                }).done(function(data) {
                    data = $.parseJSON(data);
                    // console.log(data);
                    if (data.status == 1) {
                        $('#modal_email').modal('show');
                    } else {
                        var cek_captcha = $.ajax({
                            url: '{base}/register/ajax_captcha',
                            type: 'POST',
                            data: {
                                captcha: $('#captcha').val()
                            },
                        }).done(function(data) {
                            data = $.parseJSON(data);
                            // console.log(data);
                            if (data.status == 0) {
                                $('#modal_captcha').modal('show');
                            } else {
                                $('#form_register').submit();
                            }
                        }).fail(function(error) {
                            console.log(error.responseText);
                        });
                    }
                }).fail(function(error) {
                    console.log(error.responseText);
                });
                // -------------------------------------------------------------------- //
            } else {
                $('#modal_agree').modal('show');
            }
        });
    });
</script>
